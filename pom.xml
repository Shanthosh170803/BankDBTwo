===UserAttemptDAO.java===
package quizportal.dao;
 
import java.sql.*;
import java.util.*;
import quizportal.model.LeaderboardEntry;
import quizportal.util.DBConnection;
 
public class UserAttemptDAO {
 
	public List<LeaderboardEntry> getLeaderboardByQuiz(int quizId) {
	    List<LeaderboardEntry> list = new ArrayList<>();
	 
	    String sql =
	        "SELECT u.id, u.name, u.email, MAX(ua.score) AS score " +
	        "FROM user_attempts ua " +
	        "JOIN users u ON ua.user_id = u.id " +
	        "WHERE ua.quiz_id = ? " +
	        "GROUP BY u.id, u.name, u.email " +
	        "ORDER BY score DESC, u.name ASC";
	 
	    try (Connection conn = DBConnection.getConnection();
	         PreparedStatement ps = conn.prepareStatement(sql)) {
	 
	        ps.setInt(1, quizId);
	        ResultSet rs = ps.executeQuery();
	 
	        int rank = 1;
	        while (rs.next()) {
	            LeaderboardEntry e = new LeaderboardEntry();
	            e.setUserId(rs.getInt("id"));
	            e.setUserName(rs.getString("name"));
	            e.setEmail(rs.getString("email"));
	            e.setScore(rs.getInt("score"));
	            e.setRank(rank++);
	            list.add(e);
	        }
	 
	    } catch (Exception e) {
	        e.printStackTrace();
	    }
	 
	    return list;
	}
}
===ResultViewServlet.java===
package quizportal.servlet.user;
 
import quizportal.dao.UserAttemptDAO;
import quizportal.model.UserAttempt;
 
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.*;
import javax.servlet.ServletException;
import java.io.IOException;
import java.util.List;
 
@WebServlet("/result")
public class ResultViewServlet extends HttpServlet {
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        int quizId = Integer.parseInt(req.getParameter("quizId"));
        int score = Integer.parseInt(req.getParameter("score"));
        int total = Integer.parseInt(req.getParameter("total"));
 
        UserAttemptDAO uad = new UserAttemptDAO();
        List<UserAttempt> top = uad.getLeaderboardForQuiz(quizId);
 
        req.setAttribute("score", score);
        req.setAttribute("total", total);
        req.setAttribute("leaderboard", top);
        req.setAttribute("quizId", quizId);
        req.getRequestDispatcher("/user/result.jsp").forward(req, resp);
    }
}
===SubmitQuizServlet.java===
package quizportal.servlet.user;
 
import quizportal.dao.QuestionDAO;
import quizportal.dao.UserAttemptDAO;
import quizportal.model.Question;
import quizportal.model.User;
import quizportal.model.UserAttempt;
 
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.*;
import javax.servlet.ServletException;
import java.io.IOException;
import java.util.List;
 
@WebServlet("/submitQuiz")
public class SubmitQuizServlet extends HttpServlet {
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        HttpSession session = req.getSession(false);
        if (session == null || session.getAttribute("user") == null) {
            resp.sendRedirect(req.getContextPath() + "/index.jsp");
            return;
        }
        User user = (User) session.getAttribute("user");
 
        int quizId = Integer.parseInt(req.getParameter("quizId"));
        QuestionDAO qdao = new QuestionDAO();
        List<Question> questions = qdao.getQuestionsByQuizId(quizId);
 
        int correct = 0;
        for (Question q : questions) {
            String ans = req.getParameter("q_" + q.getId());
            if (ans != null && ans.equalsIgnoreCase(q.getCorrectOption())) correct++;
        }
        int total = questions.size();
 
        // Save attempt
        UserAttempt ua = new UserAttempt();
        ua.setUserId(user.getId());
        ua.setQuizId(quizId);
        ua.setScore(correct);
        ua.setTotalQuestions(total);
 
        UserAttemptDAO uad = new UserAttemptDAO();
        uad.saveAttempt(ua);
 
        resp.sendRedirect(req.getContextPath() + "/result?quizId=" + quizId + "&score=" + correct + "&total=" + total);
    }
}
